# Руководство по развертыванию приложения

Данное руководство описывает процесс развертывания приложения с использованием GitHub и бесплатных сервисов.

## Архитектура приложения

Приложение состоит из двух частей:
- **Фронтенд**: React-приложение, развертывается на GitHub Pages
- **Бэкенд**: FastAPI-приложение, развертывается на Render.com

## Требования

- Аккаунт на GitHub
- Аккаунт на Render.com
- API-ключи для LLM (опционально, но рекомендуется для полной функциональности)

## Развертывание фронтенда на GitHub Pages

1. В настройках репозитория включите GitHub Pages:
   - Перейдите в Settings → Pages
   - Выберите "Deploy from a branch"
   - Выберите ветку `main` и папку `/docs` или `/root` (в зависимости от настроек)

2. GitHub Actions автоматически развернет фронтенд при каждом пуше в ветку `main`

## Развертывание бэкенда на Render.com

1. Зарегистрируйтесь на [Render.com](https://render.com)

2. Создайте новую веб-службу:
   - Нажмите "New +" → "Web Service"
   - Выберите ваш GitHub-репозиторий
   - Render автоматически обнаружит Dockerfile

3. Настройте переменные окружения:
    ```
    REQUIREMENTS_FILE: requirements-render.txt
    DATABASE_URL: URL для подключения к базе данных (Render предоставляет автоматически)
    REDIS_URL: URL для подключения к Redis (Render предоставляет автоматически)
    OPENAI_API_KEY: [ваш API-ключ OpenAI, если используется]
    GOOGLE_AI_API_KEY: [ваш API-ключ Google AI, если используется]
    SECRET_KEY: [сгенерируйте надежный секретный ключ]
    JWT_SECRET_KEY: [сгенерируйте надежный JWT секретный ключ]
    LOG_LEVEL: info
    ```

4. Установите переменные окружения в Render:
   - Перейдите в Settings → Environment Variables
   - Добавьте все необходимые переменные

## Настройка автоматического развертывания

### GitHub Actions для фронтенда

Workflow `.github/workflows/frontend-deploy.yml` автоматически развертывает фронтенд на GitHub Pages при пуше в ветку `main`.

### GitHub Actions для бэкенда

Для автоматического развертывания бэкенда на Render:

1. Получите API-ключ Render:
   - Перейдите в Dashboard → Settings → API Keys
   - Создайте новый API-ключ

2. Добавьте секреты в GitHub:
   - Перейдите в Settings → Secrets and variables → Actions
   - Добавьте следующие секреты:
     - `RENDER_API_KEY`: ваш API-ключ Render
     - `RENDER_SERVICE_ID`: ID вашей службы на Render (можно найти в URL при открытии службы)
     - `RENDER_DATABASE_URL`: URL базы данных (если используется внешняя)
     - `RENDER_REDIS_URL`: URL Redis (если используется внешний)
     - `OPENAI_API_KEY`: ваш API-ключ OpenAI
     - `GOOGLE_AI_API_KEY`: ваш API-ключ Google AI
     - `SECRET_KEY`: ваш секретный ключ
     - `JWT_SECRET_KEY`: ваш JWT секретный ключ

3. Workflow `.github/workflows/deploy-backend.yml` будет автоматически развертывать бэкенд при пуше в ветку `main`

## Настройка взаимодействия фронтенда и бэкенда

После развертывания бэкенда на Render.com и настройки Docker Compose:

1. Обновите URL бэкенда в фронтенд-приложении:
   - Для продакшена в Docker Compose проксирование настроено через nginx, фронтенд будет использовать относительный путь `/api` для доступа к бэкенду
   - В `nginx.conf` уже настроено проксирование `/api/` запросов к бэкенду
   - Для локальной разработки используйте `.env` файл с переменной `VITE_API_BASE_URL=http://localhost:8000/api`

2. Настройте CORS в бэкенде (в Render или в Docker Compose в переменных окружения добавьте переменную CORS_ORIGINS с URL вашего фронтенда):
   - Пример: `["https://yourusername.github.io", "https://yourusername.github.io/ai-agent-meta-cognitive", "https://your-frontend-domain.com"]`

3. При использовании Docker Compose, сборка фронтенда будет использовать переменную `VITE_API_BASE_URL` из окружения или значение по умолчанию (относительный путь `/api`)

4. Пересоберите и разверните фронтенд с новыми настройками

## Безопасность

- Не храните API-ключи и секретные ключи в открытом виде
- Используйте надежные сгенерированные ключи для SECRET_KEY и JWT_SECRET_KEY
- Регулярно обновляйте API-ключи

## Мониторинг и логирование

Render предоставляет встроенные инструменты мониторинга и логирования:
- Используйте вкладку "Logs" в панели управления Render для просмотра логов
- Включите оповещения о сбоях в настройках службы

## Устранение неполадок

Если возникают проблемы с развертыванием:

1. Проверьте логи в GitHub Actions
2. Проверьте логи в Render
3. Убедитесь, что все переменные окружения установлены правильно
4. Проверьте, что порт в приложении соответствует порту, указанному в Render (обычно 10000)

Для дополнительной помощи обратитесь к документации Render или создайте issue в репозитории.
