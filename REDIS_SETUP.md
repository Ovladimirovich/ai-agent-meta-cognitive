# Настройка Redis для проекта

Данный документ описывает процесс настройки Redis для проекта AI Агента с Мета-Познанием.

## Установка Redis

### Вариант 1: Локальная установка

1. **Установка Redis на Ubuntu/Debian:**
   ```bash
   sudo apt update
   sudo apt install redis-server
   ```

2. **Установка Redis на CentOS/RHEL:**
   ```bash
   sudo yum install epel-release
   sudo yum install redis
   ```

3. **Установка Redis на macOS:**
   ```bash
   brew install redis
   ```

4. **Установка Redis на Windows:**
   Скачайте и установите Redis из официального репозитория:
   - https://github.com/redis-windows/redis-windows

После установки запустите Redis сервер:
- Linux/macOS: `sudo systemctl start redis` или `brew services start redis`
- Windows: запустите `redis-server.exe`

### Вариант 2: Docker (опционально)

```bash
# Запуск Redis в Docker
docker run -d --name redis-cache -p 6379:6379 redis:latest
```

### Вариант 3: Использование в виртуальном окружении (venv)

При работе в виртуальном окружении Python:

1. Установите Redis на вашу систему (см. Вариант 1)
2. Активируйте ваше виртуальное окружение:
   ```bash
   # Для Linux/Mac
   source venv/bin/activate
   
   # Для Windows
   venv\Scripts\activate
   ```

3. Установите Python-пакет redis в ваше виртуальное окружение:
   ```bash
   pip install redis
   ```

4. Убедитесь, что Redis сервер запущен в системе:
   ```bash
   # Проверка запуска Redis
   redis-cli ping
   # Должен вернуть PONG
   ```

5. В проекте будет использоваться подключение через переменную окружения `REDIS_URL`

## Настройка переменных окружения

Создайте или обновите файл `.env` в корне проекта:

```env
# Redis настройки
REDIS_URL=redis://localhost:6379/0
# Альтернативные настройки (если REDIS_URL не используется):
# REDIS_HOST=localhost
# REDIS_PORT=6379
# REDIS_PASSWORD=ваш_пароль_если_есть
# REDIS_DB=0

# Настройки кэширования
CACHE_DEFAULT_TTL=3600
```

Для продакшена рекомендуется использовать URL формат:

```
REDIS_URL=redis://:password@hostname:port/database
```

## Использование Redis в приложении

### Основные функции

Redis используется в проекте для:

1. **Кэширования данных** - ускорение доступа к часто запрашиваемым данным
2. **Хранения сессий** - управление сессиями пользователей
3. **Ограничения частоты запросов** - защита от DDoS-атак
4. **Очередей задач** - асинхронная обработка задач
5. **Хранения временных данных** - промежуточные результаты и состояния

### Примеры использования

```python
from cache.redis_config import get_redis_cache

# Получение экземпляра Redis кэша
cache = get_redis_cache()

# Установка значения
cache.set("key", b"value", ttl=3600)

# Получение значения
value = cache.get("key")

# Удаление значения
cache.delete("key")
```

## Проверка подключения

Для проверки подключения к Redis можно использовать следующую команду:

```bash
redis-cli ping
```

Должен вернуться ответ `PONG`.

## Безопасность

1. **Аутентификация:**
   - Установите пароль в конфигурации Redis
   - Используйте переменные окружения для хранения паролей

2. **Брандмауэр:**
   - Ограничьте доступ к порту Redis только доверенным приложениям
   - Используйте VPN или приватные сети для продакшена

3. **Шифрование:**
   - Для облачных установок используйте TLS/SSL соединения

## Мониторинг

Redis предоставляет команды для мониторинга:

```bash
# Общая информация
redis-cli info

# Статистика по ключам
redis-cli info keyspace

# Мониторинг команд в реальном времени
redis-cli monitor
```

## Производительность

1. **Настройки для производительности:**
   - Используйте память SSD для хранения данных
   - Настройте параметры persistence в зависимости от требований
   - Ограничьте максимальный объем используемой памяти

2. **Оптимизация:**
   - Регулярно очищайте устаревшие ключи
   - Используйте подходящие TTL для разных типов данных
   - Мониторьте использование памяти

## Устранение неполадок

1. **Проблемы с подключением:**
   - Проверьте, запущен ли Redis сервер
   - Проверьте настройки firewall
   - Убедитесь, что хост и порт указаны правильно

2. **Проблемы с производительностью:**
   - Проверьте использование памяти
   - Проверьте количество подключений
   - Оптимизируйте TTL значений

## Использование в продакшене

Для продакшена рекомендуется:

1. Использовать облачные Redis сервисы (AWS ElastiCache, Google Cloud Memorystore, Azure Cache)
2. Настроить репликацию и кластеризацию
3. Включить persistence для критичных данных
4. Настроить мониторинг и алертинг
5. Регулярно обновлять версию Redis

Для облачных провайдеров используйте соответствующий URL в переменной `REDIS_URL`.